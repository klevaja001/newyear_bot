import os
import logging
from flask import Flask, request
import telebot
from datetime import datetime
import threading
import time
import schedule

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = Flask(__name__)

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏ ID –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway
BOT_TOKEN = os.environ.get('BOT_TOKEN')
USER_ID = os.environ.get('USER_ID')

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω—ã
if not BOT_TOKEN or not USER_ID:
    logger.error("‚ùå BOT_TOKEN –∏–ª–∏ USER_ID –Ω–µ –∑–∞–¥–∞–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!")
    raise ValueError("–ó–∞–¥–∞–π—Ç–µ BOT_TOKEN –∏ USER_ID –≤ Railway Variables")

bot = telebot.TeleBot(BOT_TOKEN)
logger.info(f"‚úÖ –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {USER_ID}")

# –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π (–ø–æ–ª–Ω—ã–π –∏–∑ 31 –∑–∞–¥–∞–Ω–∏—è)
tasks = [
    "–ù–∞—á–∞—Ç—å —É–∫—Ä–∞—à–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –∫ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º",
    "–ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –≥–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥ —Å –º–∞—Ä—à–º–µ–ª–ª–æ—É –∏ —Å–ø–µ—Ü–∏—è–º–∏",
    "–†–∞–∑—ã–≥—Ä–∞—Ç—å —Ç–∞–π–Ω–æ–≥–æ –°–∞–Ω—Ç—É",
    "–°–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –ø–ª–µ–π–ª–∏—Å—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è",
    "–£—Å—Ç—Ä–æ–∏—Ç—å –≤–µ—á–µ—Ä –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª—é–±–∏–º—ã—Ö –∑–∏–º–Ω–∏—Ö —Ñ–∏–ª—å–º–æ–≤",
    "–ü–æ–∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—å–∫–∞—Ö –ø–æ–¥ –Ω–æ–≤–æ–≥–æ–¥–Ω—é—é –º—É–∑—ã–∫—É",
    "–°–≤–∞—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä—Å–∫–∏–π –≥–ª–∏–Ω—Ç–≤–µ–π–Ω –ø–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É",
    "–°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ç–æ–∫–Ω–∏–≥—É —É—Ö–æ–¥—è—â–µ–≥–æ –≥–æ–¥–∞",
    "–°—Ö–æ–¥–∏—Ç—å –Ω–∞ —Ä–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫—É—é —è—Ä–º–∞—Ä–∫—É –∑–∞ —Å—É–≤–µ–Ω–∏—Ä–∞–º–∏",
    "–ö—É–ø–∏—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –≤–µ–Ω–æ–∫",
    "–ò—Å–ø–µ—á—å –≥–æ—Ç–æ–≤–æ–µ –∏–º–±–∏—Ä–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ –∏–∑ –Ω–∞–±–æ—Ä–∞",
    "–°—Ö–æ–¥–∏—Ç—å –Ω–∞ –∑–∏–º–Ω—é—é –ø—Ä–æ–≥—É–ª–∫—É –≤ –ø–∞—Ä–∫",
    "–£—Å—Ç—Ä–æ–∏—Ç—å –≤–µ—á–µ—Ä –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –∏–≥—Ä –ø—Ä–∏ —Å–≤–µ—á–∞—Ö",
    "–ù–∞–ø–∏—Å–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∑–∞ –≥–æ–¥",
    "–ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ —Å–∞–º–æ–º—É —Å–µ–±–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥",
    "–ö—É–ø–∏—Ç—å —É—é—Ç–Ω—ã–π –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π —Å–≤–∏—Ç–µ—Ä",
    "–°–¥–µ–ª–∞—Ç—å –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è –∏–∑ –≥–æ—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞",
    "–°—Ö–æ–¥–∏—Ç—å –≤ –±–∞–Ω—é –∏–ª–∏ —Å–∞—É–Ω—É —Å –∞—Ä–æ–º–∞–º–∞—Å–ª–∞–º–∏",
    "–ó–∞–∫–∞–∑–∞—Ç—å —Å—É—à–∏ –∏ —É—Å—Ç—Ä–æ–∏—Ç—å –∫–∏–Ω–æ–≤–µ—á–µ—Ä",
    "–ü–æ–µ—Ö–∞—Ç—å –∑–∞ –≥–æ—Ä–æ–¥ –Ω–∞ –∑–∏–º–Ω—é—é –ø—Ä–æ–≥—É–ª–∫—É",
    "–°—Ö–æ–¥–∏—Ç—å –≤ –∫–∞—Ñ–µ –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ—Å–µ—Ä—Ç",
    "–°—Ö–æ–¥–∏—Ç—å –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Ñ–∏–ª—å–º",
    "–£–ø–∞–∫–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∏ –≤ –∫—Ä–∞—Å–∏–≤—É—é –±—É–º–∞–≥—É",
    "–°–¥–µ–ª–∞—Ç—å –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ",
    "–ü–æ—Å–µ—Ç–∏—Ç—å –Ω–æ–≤–æ–≥–æ–¥–Ω—é—é —è—Ä–º–∞—Ä–∫—É –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞",
    "–°–¥–µ–ª–∞—Ç—å –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—É—é —É–±–æ—Ä–∫—É",
    "–°—Ö–æ–¥–∏—Ç—å –≤ –≥–æ—Å—Ç–∏ –∫ –¥—Ä—É–∑—å—è–º —Å —É–≥–æ—â–µ–Ω–∏—è–º–∏",
    "–°—Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –∫–æ–Ω—Ü–µ—Ä—Ç –∏–ª–∏ —Å–ø–µ–∫—Ç–∞–∫–ª—å",
    "–ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏ –≥–æ–¥–∞ –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π",
    "–ù–∞—Å–ª–∞–¥–∏—Ç—å—Å—è —Å–ø–æ–∫–æ–π–Ω—ã–º –≤–µ—á–µ—Ä–æ–º –ø–µ—Ä–µ–¥ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º",
    "–ó–∞–≥–∞–¥–∞—Ç—å –∂–µ–ª–∞–Ω–∏–µ –ø–æ–¥ –±–æ–π –∫—É—Ä–∞–Ω—Ç–æ–≤"
]

logger.info(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(tasks)} –∑–∞–¥–∞–Ω–∏–π")

# ========== ROUTES ==========

@app.route('/')
def home():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã"""
    current_time = datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')
    return f'''
    <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!</h1>
    <p><strong>–í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞:</strong> {current_time}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</p>
    <p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> {len(tasks)}</p>
    <p><strong>USER_ID:</strong> {USER_ID}</p>
    <hr>
    <p>–ë–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 8:00 –ø–æ –ú–æ—Å–∫–≤–µ (5:00 UTC)</p>
    '''

@app.route('/health')
def health_check():
    """–î–ª—è health-check Railway"""
    return 'OK', 200

@app.route('/webhook', methods=['POST'])
def webhook():
    """–í–µ–±—Ö—É–∫ –¥–ª—è Telegram"""
    if request.headers.get('content-type') == 'application/json':
        json_string = request.get_data().decode('utf-8')
        update = telebot.types.Update.de_json(json_string)
        bot.process_new_updates([update])
        logger.info("‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç Telegram")
        return ''
    return 'Bad Request', 400

# ========== BOT COMMANDS ==========

@bot.message_handler(commands=['start'])
def send_welcome(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    welcome_text = '''
üéÖ *–ü—Ä–∏–≤–µ—Ç! –Ø –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –±–æ—Ç!*

–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 8:00 —É—Ç—Ä–∞ —è –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ç–µ–±–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å.

*–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/today - –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
/task <—á–∏—Å–ª–æ> - –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å (1-31)
/help - –°–ø—Ä–∞–≤–∫–∞

*–ù–∞—Å—Ç—Ä–æ–π–∫–∏:*
‚Ä¢ –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: 8:00 —É—Ç—Ä–∞ (–ú–°–ö)
‚Ä¢ –ü–µ—Ä–∏–æ–¥: 1-31 –¥–µ–∫–∞–±—Ä—è
‚Ä¢ –ó–∞–¥–∞–Ω–∏–π –≤—Å–µ–≥–æ: 31

_–ì–æ—Ç–æ–≤ –æ–∫—É–Ω—É—Ç—å—Å—è –≤ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É? üéÑ_
    '''
    bot.reply_to(message, welcome_text, parse_mode='Markdown')
    logger.info(f"üëã –û—Ç–ø—Ä–∞–≤–ª–µ–Ω welcome –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.chat.id}")

@bot.message_handler(commands=['today'])
def send_today_task(message):
    """–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
    today = datetime.now().day
    if 1 <= today <= 31:
        task = tasks[today - 1]
        response = f"üéÅ *–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ {today} –¥–µ–∫–∞–±—Ä—è:*\n\n{task}"
        bot.reply_to(message, response, parse_mode='Markdown')
        logger.info(f"üìÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({today} –¥–µ–∫–∞–±—Ä—è)")
    else:
        bot.reply_to(message, "üéÖ –°–µ–π—á–∞—Å –Ω–µ –¥–µ–∫–∞–±—Ä—å! –ó–∞–¥–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å 1 –ø–æ 31 –¥–µ–∫–∞–±—Ä—è.")
        logger.info("‚ùå –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –≤–Ω–µ –¥–µ–∫–∞–±—Ä—è")

@bot.message_handler(commands=['task'])
def send_specific_task(message):
    """–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å"""
    try:
        # –ü–∞—Ä—Å–∏–º –∫–æ–º–∞–Ω–¥—É /task 5
        day = int(message.text.split()[1])
        if 1 <= day <= 31:
            task = tasks[day - 1]
            response = f"üéÅ *–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ {day} –¥–µ–∫–∞–±—Ä—è:*\n\n{task}"
            bot.reply_to(message, response, parse_mode='Markdown')
            logger.info(f"üìÜ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ {day} –¥–µ–∫–∞–±—Ä—è")
        else:
            bot.reply_to(message, "‚ùå –£–∫–∞–∂–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 31")
    except (IndexError, ValueError):
        bot.reply_to(message, "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /task <—á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 31>")

@bot.message_handler(commands=['help'])
def send_help(message):
    """–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"""
    help_text = '''
*üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –±–æ—Ç - –ü–æ–º–æ—â—å*

*–ö–æ–º–∞–Ω–¥—ã:*
/start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
/today - –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
/task <—á–∏—Å–ª–æ> - –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å (1-31)
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

*–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:*
‚Ä¢ –ó–∞–¥–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ *8:00 —É—Ç—Ä–∞ (–ø–æ –ú–æ—Å–∫–≤–µ)*
‚Ä¢ –í—Å–µ–≥–æ 31 –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–µ–∫–∞–±—Ä—è
‚Ä¢ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω —Å 1 –ø–æ 31 –¥–µ–∫–∞–±—Ä—è

*–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:*
‚Ä¢ –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: UTC
‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
‚Ä¢ –°—Ç–∞—Ç—É—Å: [newyearbot-production.up.railway.app](https://newyearbot-production.up.railway.app)

_–í–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã? –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Å–æ–æ–±—â–µ–Ω–∏—è 24/7!_
    '''
    bot.reply_to(message, help_text, parse_mode='Markdown', disable_web_page_preview=True)

@bot.message_handler(func=lambda message: True)
def echo_all(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    bot.reply_to(message, "üéÖ –ò—Å–ø–æ–ª—å–∑—É–π /help —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã")

# ========== SCHEDULED TASKS ==========

def send_daily_task():
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏—è"""
    try:
        today = datetime.now().day
        if 1 <= today <= 31:
            task = tasks[today - 1]
            message_text = f"üéÑ *–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!*\n\n*–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ {today} –¥–µ–∫–∞–±—Ä—è:*\n\n{task}\n\n_–£–¥–∞—á–Ω–æ–≥–æ –¥–Ω—è –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è! üéÖ_"
            bot.send_message(USER_ID, message_text, parse_mode='Markdown')
            logger.info(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ {today} –¥–µ–∫–∞–±—Ä—è")
        else:
            logger.info("üìÖ –°–µ–≥–æ–¥–Ω—è –Ω–µ –¥–µ–∫–∞–±—Ä—å, –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è: {e}")

def scheduler_loop():
    """–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞"""
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: 5:00 UTC = 8:00 –ú–°–ö
    schedule.every().day.at("05:00").do(send_daily_task)
    logger.info("‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 05:00 UTC (8:00 –ú–°–ö)")
    
    # –¢–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ 10:00 UTC –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    schedule.every().day.at("10:00").do(lambda: logger.info("‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω"))
    
    while True:
        schedule.run_pending()
        time.sleep(60)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

# ========== START APPLICATION ==========

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    scheduler_thread = threading.Thread(target=scheduler_loop, daemon=True)
    scheduler_thread.start()
    logger.info("üöÄ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ")
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ä—Ç –æ—Ç Railway
    port = int(os.environ.get('PORT', 5000))
    logger.info(f"üåê –ó–∞–ø—É—Å–∫ Flask –Ω–∞ –ø–æ—Ä—Ç—É {port}")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask
    app.run(host='0.0.0.0', port=port, debug=False)
